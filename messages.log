[2025-11-16T19:25:58.696344+00:00] device2@('127.0.0.1', 60346): hello
[2025-11-16T19:48:11.725707+00:00] device1@('127.0.0.1', 60701): Hello server!
[2025-11-16T19:51:14.921317+00:00] device2@('127.0.0.1', 51740): Hello server!
[2025-11-16T20:06:07.654673+00:00] device2@('127.0.0.1', 51840): .search test.txt
[2025-11-16T20:08:49.603693+00:00] device2@('127.0.0.1', 62671): hello
[2025-11-16T20:10:23.807628+00:00] device2@('127.0.0.1', 62671): import socket, argparse, os, json, time
[2025-11-16T20:10:23.814996+00:00] device2@('127.0.0.1', 62671): parser = argparse.ArgumentParser()
[2025-11-16T20:10:23.816677+00:00] device2@('127.0.0.1', 62671): parser.add_argument('--host', required=True)
[2025-11-16T20:10:23.817276+00:00] device2@('127.0.0.1', 62671): parser.add_argument('--port', required=True, type=int)
[2025-11-16T20:10:23.818173+00:00] device2@('127.0.0.1', 62671): parser.add_argument('--user', required=True)
[2025-11-16T20:10:23.818621+00:00] device2@('127.0.0.1', 62671): parser.add_argument('--password', required=True)
[2025-11-16T20:10:23.819259+00:00] device2@('127.0.0.1', 62671): args = parser.parse_args()
[2025-11-16T20:10:23.820089+00:00] device2@('127.0.0.1', 62671): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
[2025-11-16T20:10:23.820708+00:00] device2@('127.0.0.1', 62671): s.connect((args.host, args.port))
[2025-11-16T20:10:23.821386+00:00] device2@('127.0.0.1', 62671): s.sendall(f"HELLO {args.user} {args.password}\n".encode())
[2025-11-16T20:10:23.822191+00:00] device2@('127.0.0.1', 62671): welcome = b""
[2025-11-16T20:10:23.822971+00:00] device2@('127.0.0.1', 62671): while True:
[2025-11-16T20:10:23.823627+00:00] device2@('127.0.0.1', 62671): chunk = s.recv(4096)
[2025-11-16T20:10:23.824202+00:00] device2@('127.0.0.1', 62671): if not chunk:
[2025-11-16T20:10:23.824643+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.825016+00:00] device2@('127.0.0.1', 62671): welcome += chunk
[2025-11-16T20:10:23.825429+00:00] device2@('127.0.0.1', 62671): if b'WELCOME' in welcome or b'AUTH_FAILED' in welcome:
[2025-11-16T20:10:23.825942+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.826719+00:00] device2@('127.0.0.1', 62671): welcome_clean = welcome.decode(errors='ignore').replace("\r", "").strip()
[2025-11-16T20:10:23.827289+00:00] device2@('127.0.0.1', 62671): print(welcome_clean)
[2025-11-16T20:10:23.827913+00:00] device2@('127.0.0.1', 62671): role = "full" if "full" in welcome_clean.lower() else "read"
[2025-11-16T20:10:23.828291+00:00] device2@('127.0.0.1', 62671): print(f"Assigned role: {role}")
[2025-11-16T20:10:23.828830+00:00] device2@('127.0.0.1', 62671): def receive_line(sock, timeout=2.0):
[2025-11-16T20:10:23.829202+00:00] device2@('127.0.0.1', 62671): sock.settimeout(timeout)
[2025-11-16T20:10:23.829503+00:00] device2@('127.0.0.1', 62671): data = b''
[2025-11-16T20:10:23.829854+00:00] device2@('127.0.0.1', 62671): while True:
[2025-11-16T20:10:23.830164+00:00] device2@('127.0.0.1', 62671): try:
[2025-11-16T20:10:23.830519+00:00] device2@('127.0.0.1', 62671): part = sock.recv(4096)
[2025-11-16T20:10:23.830885+00:00] device2@('127.0.0.1', 62671): except socket.timeout:
[2025-11-16T20:10:23.831242+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.831766+00:00] device2@('127.0.0.1', 62671): if not part:
[2025-11-16T20:10:23.832231+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.832601+00:00] device2@('127.0.0.1', 62671): data += part
[2025-11-16T20:10:23.832962+00:00] device2@('127.0.0.1', 62671): if b'\n' in data:
[2025-11-16T20:10:23.833319+00:00] device2@('127.0.0.1', 62671): line, _, _ = data.partition(b'\n')
[2025-11-16T20:10:23.833919+00:00] device2@('127.0.0.1', 62671): return line
[2025-11-16T20:10:23.834237+00:00] device2@('127.0.0.1', 62671): return data
[2025-11-16T20:10:23.834933+00:00] device2@('127.0.0.1', 62671): try:
[2025-11-16T20:10:23.835290+00:00] device2@('127.0.0.1', 62671): while True:
[2025-11-16T20:10:23.835878+00:00] device2@('127.0.0.1', 62671): cmd = input("> ").strip()
[2025-11-16T20:10:23.836259+00:00] device2@('127.0.0.1', 62671): if not cmd:
[2025-11-16T20:10:23.836668+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.837269+00:00] device2@('127.0.0.1', 62671): if cmd.startswith(('/upload', '/delete', '/download')) and role != 'full':
[2025-11-16T20:10:23.837743+00:00] device2@('127.0.0.1', 62671): print("Read-only client — nuk ke leje për këtë komandë.")
[2025-11-16T20:10:23.838077+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.838729+00:00] device2@('127.0.0.1', 62671): if cmd.startswith('/upload') and role == 'full':
[2025-11-16T20:10:23.839119+00:00] device2@('127.0.0.1', 62671): parts = cmd.split(maxsplit=1)
[2025-11-16T20:10:23.839533+00:00] device2@('127.0.0.1', 62671): if len(parts) != 2:
[2025-11-16T20:10:23.839972+00:00] device2@('127.0.0.1', 62671): print("Usage: /upload <filename>")
[2025-11-16T20:10:23.840323+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.840761+00:00] device2@('127.0.0.1', 62671): filename = parts[1]
[2025-11-16T20:10:23.841167+00:00] device2@('127.0.0.1', 62671): if not os.path.isfile(filename):
[2025-11-16T20:10:23.841542+00:00] device2@('127.0.0.1', 62671): print("File nuk ekziston!")
[2025-11-16T20:10:23.841908+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.842529+00:00] device2@('127.0.0.1', 62671): filesize = os.path.getsize(filename)
[2025-11-16T20:10:23.843076+00:00] device2@('127.0.0.1', 62671): s.sendall(f"/upload {os.path.basename(filename)}\n".encode())
[2025-11-16T20:10:23.843444+00:00] device2@('127.0.0.1', 62671): ready = receive_line(s)
[2025-11-16T20:10:23.844258+00:00] device2@('127.0.0.1', 62671): if not ready or b"READY_META" not in ready:
[2025-11-16T20:10:23.844800+00:00] device2@('127.0.0.1', 62671): print("Server nuk pranoi upload (no READY_META). Response:", ready)
[2025-11-16T20:10:23.845185+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.845780+00:00] device2@('127.0.0.1', 62671): meta = json.dumps({"filename": os.path.basename(filename), "size": filesize})
[2025-11-16T20:10:23.846237+00:00] device2@('127.0.0.1', 62671): s.sendall((meta + '\n').encode())
[2025-11-16T20:10:23.846664+00:00] device2@('127.0.0.1', 62671): ready2 = receive_line(s)
[2025-11-16T20:10:23.847082+00:00] device2@('127.0.0.1', 62671): if not ready2 or b"READY_DATA" not in ready2:
[2025-11-16T20:10:23.847615+00:00] device2@('127.0.0.1', 62671): print("Server nuk gjeti READY_DATA. Response:", ready2)
[2025-11-16T20:10:23.848038+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.848609+00:00] device2@('127.0.0.1', 62671): with open(filename, 'rb') as f:
[2025-11-16T20:10:23.849044+00:00] device2@('127.0.0.1', 62671): s.sendall(f.read())
[2025-11-16T20:10:23.849472+00:00] device2@('127.0.0.1', 62671): final = receive_line(s)
[2025-11-16T20:10:23.849797+00:00] device2@('127.0.0.1', 62671): if final:
[2025-11-16T20:10:23.850283+00:00] device2@('127.0.0.1', 62671): print(final.decode(errors='ignore'))
[2025-11-16T20:10:23.850662+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.851209+00:00] device2@('127.0.0.1', 62671): if cmd.startswith('/download') and role == 'full':
[2025-11-16T20:10:23.851602+00:00] device2@('127.0.0.1', 62671): parts = cmd.split(maxsplit=1)
[2025-11-16T20:10:23.852036+00:00] device2@('127.0.0.1', 62671): if len(parts) != 2:
[2025-11-16T20:10:23.852412+00:00] device2@('127.0.0.1', 62671): print("Usage: /download <filename>")
[2025-11-16T20:10:23.852831+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.853209+00:00] device2@('127.0.0.1', 62671): filename = parts[1]
[2025-11-16T20:10:23.853654+00:00] device2@('127.0.0.1', 62671): s.sendall(f"/download {filename}\n".encode())
[2025-11-16T20:10:23.854059+00:00] device2@('127.0.0.1', 62671): meta_line = receive_line(s)
[2025-11-16T20:10:23.854401+00:00] device2@('127.0.0.1', 62671): if not meta_line:
[2025-11-16T20:10:23.854866+00:00] device2@('127.0.0.1', 62671): print("No response from server.")
[2025-11-16T20:10:23.855346+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.855807+00:00] device2@('127.0.0.1', 62671): meta_line = meta_line.decode(errors='ignore')
[2025-11-16T20:10:23.856240+00:00] device2@('127.0.0.1', 62671): if meta_line.startswith("ERROR"):
[2025-11-16T20:10:23.856655+00:00] device2@('127.0.0.1', 62671): print(meta_line)
[2025-11-16T20:10:23.857055+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.857558+00:00] device2@('127.0.0.1', 62671): if not meta_line.startswith("FILEMETA"):
[2025-11-16T20:10:23.857968+00:00] device2@('127.0.0.1', 62671): print("Unexpected response:", meta_line)
[2025-11-16T20:10:23.859103+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.859496+00:00] device2@('127.0.0.1', 62671): _, _, j = meta_line.partition(' ')
[2025-11-16T20:10:23.859895+00:00] device2@('127.0.0.1', 62671): meta = json.loads(j)
[2025-11-16T20:10:23.860292+00:00] device2@('127.0.0.1', 62671): size = int(meta.get('size', 0))
[2025-11-16T20:10:23.860713+00:00] device2@('127.0.0.1', 62671): s.sendall(b"READY\n")
[2025-11-16T20:10:23.861099+00:00] device2@('127.0.0.1', 62671): received = b''
[2025-11-16T20:10:23.861540+00:00] device2@('127.0.0.1', 62671): while len(received) < size:
[2025-11-16T20:10:23.862023+00:00] device2@('127.0.0.1', 62671): chunk = s.recv(min(4096, size - len(received)))
[2025-11-16T20:10:23.862449+00:00] device2@('127.0.0.1', 62671): if not chunk:
[2025-11-16T20:10:23.862790+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.863194+00:00] device2@('127.0.0.1', 62671): received += chunk
[2025-11-16T20:10:23.863643+00:00] device2@('127.0.0.1', 62671): with open(filename, 'wb') as f:
[2025-11-16T20:10:23.864051+00:00] device2@('127.0.0.1', 62671): f.write(received)
[2025-11-16T20:10:23.864643+00:00] device2@('127.0.0.1', 62671): print(f"Downloaded {filename} ({len(received)} bytes)")
[2025-11-16T20:10:23.865211+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.865719+00:00] device2@('127.0.0.1', 62671): s.sendall((cmd + '\n').encode())
[2025-11-16T20:10:23.866238+00:00] device2@('127.0.0.1', 62671): timeout = 0.5 if role == "full" else 2.0
[2025-11-16T20:10:23.866628+00:00] device2@('127.0.0.1', 62671): start_time = time.time()
[2025-11-16T20:10:23.867023+00:00] device2@('127.0.0.1', 62671): data = b''
[2025-11-16T20:10:23.867346+00:00] device2@('127.0.0.1', 62671): while True:
[2025-11-16T20:10:23.867770+00:00] device2@('127.0.0.1', 62671): if time.time() - start_time > timeout:
[2025-11-16T20:10:23.868172+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.868550+00:00] device2@('127.0.0.1', 62671): try:
[2025-11-16T20:10:23.868927+00:00] device2@('127.0.0.1', 62671): chunk = s.recv(4096)
[2025-11-16T20:10:23.869370+00:00] device2@('127.0.0.1', 62671): except BlockingIOError:
[2025-11-16T20:10:23.869744+00:00] device2@('127.0.0.1', 62671): time.sleep(0.05)
[2025-11-16T20:10:23.870116+00:00] device2@('127.0.0.1', 62671): continue
[2025-11-16T20:10:23.870459+00:00] device2@('127.0.0.1', 62671): if not chunk:
[2025-11-16T20:10:23.870806+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.871191+00:00] device2@('127.0.0.1', 62671): data += chunk
[2025-11-16T20:10:23.871613+00:00] device2@('127.0.0.1', 62671): if len(chunk) < 4096:
[2025-11-16T20:10:23.871980+00:00] device2@('127.0.0.1', 62671): break
[2025-11-16T20:10:23.872319+00:00] device2@('127.0.0.1', 62671): if data:
[2025-11-16T20:10:23.872736+00:00] device2@('127.0.0.1', 62671): print(data.decode(errors='ignore'))
[2025-11-16T20:10:23.873398+00:00] device2@('127.0.0.1', 62671): except KeyboardInterrupt:
[2025-11-16T20:10:23.873791+00:00] device2@('127.0.0.1', 62671): print("\nClosing connection...")
[2025-11-16T20:10:23.874138+00:00] device2@('127.0.0.1', 62671): finally:
[2025-11-16T20:10:23.874770+00:00] device2@('127.0.0.1', 62671): s.close()
[2025-11-16T20:13:09.030920+00:00] device2@('127.0.0.1', 59951): delete test.txt
[2025-11-16T20:28:11.279738+00:00] device1@('127.0.0.1', 52541): Hello server!
[2025-11-16T21:01:56.454192+00:00] device1@('127.0.0.1', 56110): python .\client.py --host 127.0.0.1 --port 9000 --user device2 --password pass2
